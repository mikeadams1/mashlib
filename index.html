<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html id='docHTML'>
<head>
    <title>Tabulator: Async Javascript And Semantic Web</title>
    <link rel="stylesheet" href="chrome://tabulator/content/js/calView/assets/calendar.css" type="text/css" />
    <link rel="stylesheet" href="chrome://tabulator/content/js/calView/assets/bigCal.css" type="text/css" />
    <link rel="stylesheet" href="chrome://tabulator/content/tabbedtab.css" type="text/css" />
    <script src="js/views/timeutil.js" type="text/javascript"></script>
    <script src="js/views/calView.js" type="text/javascript"></script>
    <script src="js/views/calView/timeline/api/timeline-api.js" type="text/javascript"></script>
    <script src="js/views/calView/timeline/api/timelineView.js" type="text/javascript"></script>
    <script src="js/views/calView/calView.js" type="text/javascript"></script>
    <script src="js/rdf/util.js" type="text/javascript"></script>
    <script src="js/tab/util-nonlib.js" type="text/javascript"></script>
</head>

<body>
    <div class="viewArea" id="viewArea">
    </div>
    <div id="divCal" class="divCal" style="display:none">
    </div>
</body>

    <script type="application/x-javascript">
      function calLoader() {
        tabulator = Components.classes["@dig.csail.mit.edu/tabulator;1"].getService(Components.interfaces.nsISupports).wrappedJSObject;
        //Horrible global vars :(
        kb = tabulator.kb;
        sf = tabulator.fetcher;
        qs = tabulator.qs;
        var myCalView = new calView(document.getElementById('viewArea'));
        qs.addListener(myCalView);
        //extract the query ID Here!
        
        var q = qs.queries[getURIQueryParameters(window.location)['query']];
        myCalView.drawQuery(q);
      }
      document.onLoad=calLoader();
    </script>
</html>

<!DOCTYPE html>
<html id="docHTML">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="content-type">
  <!-- was https://solid.github.io/solid-panes/style/tabbedtab.css   -->
    <link type="text/css" rel="stylesheet" href="mash.css" />
    <script type="text/javascript" src="https://mikeadams1.github.io/form-playground/mashlib.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const panes = require('mashlib')
    const UI = panes.UI
    const $rdf = UI.rdf
    const dom = document
    $rdf.Fetcher.crossSiteProxyTemplate = self.origin + '/xss?uri={uri}';
    var uri = window.location.href;
    window.document.title = 'Data browser: ' + uri;
    var kb = UI.store;
    var outliner = panes.getOutliner(dom)
     function go ( event ) {
      let uri = $rdf.uri.join(uriField.value, window.location.href)
      console.log("User field " + uriField.value)
      console.log("User requests " + uri)
       const params = new URLSearchParams(location.search)
      params.set('uri', uri);
      window.history.replaceState({}, '', `${location.pathname}?${params}`);
       var subject = kb.sym(uri);
      // UI.widgets.makeDraggable(icon, subject) // beware many handlers piling up
      outliner.GotoSubject(subject, true, undefined, true, undefined);
    }
     const uriField = dom.getElementById('uriField')
    const goButton = dom.getElementById('goButton')
    uriField.addEventListener('keyup', function (e) {
      if (e.keyCode === 13) {
        go(e)
      }
    }, false)
     goButton.addEventListener('click', go, false);
    let initial = new URLSearchParams(self.location.search).get("uri")
    if (initial) {
      uriField.value = initial
      go()
    } else {
      console.log('ready for user input')
    }
 });
</script>
</head>
<body>
  <table style="width:100%;">
    <tr>Data browser</tr>
    <tr style="font-size:100%">
      <td style="padding:1em; width:5em;" id="icon">URI:</td>
      <td><input id="uriField" type="text" style="font-size:100%; min-width:30em; padding:0.5em; width:95%;"/></td>
      <td  style="width:5em;"><input type="button" id="goButton" value="Go" /></td>
    </tr>
    <tr>
      <div class="TabulatorOutline" id="DummyUUID">
          <table id="outline"></table>
      </div>
    </tr>
</table>
  
</body>
</html
